<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <style>
        .actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
    </style>
</head>
<body>

<h1>Login</h1>
<form id="loginForm">
    <input name="username" placeholder="Username" required><br><br>
    <input name="password" type="password" placeholder="Password" required><br><br>
    <div class="actions">
        <button type="submit">Login</button>
        <button type="button" onclick="window.location.href='/TicketBooker-0.1/register.html'">Register</button>
    </div>
</form>

<p id="message" style="font-weight: bold; color: red"></p>

<script>
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = e.target;
        const payload = {
            username: formData.username.value,
            password: formData.password.value
        };

        const res = await fetch('/TicketBooker-0.1/login', {
            method: 'POST',
            body: JSON.stringify(payload)
        });

        localStorage.setItem("username", payload.username);

        const data = await res.json();

        if (data.status === "success") {
            const page = data.isAdmin ? "admin.html" : "home.html";
            window.location.href = `/TicketBooker-0.1/${page}`;
        } else {
            document.getElementById("message").innerText =
                "Invalid credentials.";
        }
    });
</script>

</body>
</html>