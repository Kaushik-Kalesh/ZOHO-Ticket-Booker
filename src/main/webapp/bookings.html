<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bookings</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="navbar-container"></div>

<h1>Your Bookings</h1>
<div id="app"></div>

<script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
<script src="helpers.js"></script>

<!-- Templates -->
<script id="appTpl" type="text/x-handlebars-template">

    <table>
        <thead>
            <tr>
                <th>Cost</th>
                <th>Time</th>
                <th>Screen</th>
                <th>Show</th>
                <th>Seats</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {{#each bookings}}
            <tr>
                <td>Rs. {{mul show.screen.price seatsBooked}}</td>
                <td>{{bookingTime}}</td>
                <td>{{show.screen.name}}</td>
                <td>{{show.title}}</td>
                <td>{{seatsBooked}}</td>
                <td><button onclick="cancelBooking('{{id}}')">Cancel</button></td>
            </tr>
            {{/each}}
        </tbody>
    </table>

</script>
<!-- End Templates -->

<script src="navbar.js"></script>

<script>
    const load = async () => {
        const res = await fetch('/TicketBooker-0.1/book');
        const data = await res.json();

        if (data.error) {
            window.location.href = '/TicketBooker-0.1';
            return;
        }

        let template = Handlebars.compile(
            document.getElementById("appTpl").innerHTML
        );

        document.getElementById("app").innerHTML = template(data);
    }

    load();

    const cancelBooking = async (bookingId) => {
        if (!confirm("Are you sure you want to cancel this booking?")) return;

        const res = await fetch(`/TicketBooker-0.1/book?bookingId=${bookingId}`, {
            method: "DELETE"
        });

        if (res.ok) {
            load();
        }

        const data = await res.json();
        alert(data.error);
    }
</script>

</body>
</html>