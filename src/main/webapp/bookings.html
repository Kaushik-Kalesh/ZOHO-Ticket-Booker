<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bookings</title>
</head>
<body>

<div id="navbar-container"></div>

<h1>Your Bookings</h1>
<div id="app"></div>

<script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
<script src="helpers.js"></script>

<!-- Templates -->
<script id="appTpl" type="text/x-handlebars-template">

    {{#each bookings}}
    <div class="bookingCard">
        <b>Cost: Rs. {{mul show.screen.price seatsBooked}}</b>
        <p>Time: {{bookingTime}}</p>
        <p>Screen: {{show.screen.name}}</p>
        <p>Show: {{show.title}}</p>
        <p>Seats: {{seatsBooked}}</p>
        <button onclick="cancelBooking('{{id}}')">Cancel</button>
        <hr/>
    </div>
    {{/each}}

</script>
<!-- End Templates -->

<script src="navbar.js"></script>

<script>
    const load = async () => {
        const res = await fetch('/TicketBooker-0.1/book');
        const data = await res.json();

        if (data.error) {
            window.location.href = '/TicketBooker-0.1';
            return;
        }

        let template = Handlebars.compile(
            document.getElementById("appTpl").innerHTML
        );

        document.getElementById("app").innerHTML = template(data);
    }

    load();

    const cancelBooking = async (bookingId) => {
        if (!confirm("Are you sure you want to cancel this booking?")) return;

        const res = await fetch(`/TicketBooker-0.1/book?bookingId=${bookingId}`, {
            method: "DELETE"
        });

        if (res.ok) {
            window.location.reload();
        }

        const data = await res.json();
        alert(data.error);
    }
</script>

</body>
</html>